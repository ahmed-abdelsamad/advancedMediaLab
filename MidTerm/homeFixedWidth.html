<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Trust Me!</title>
<link rel="stylesheet" media="all" href="reset.css" />
<link rel="stylesheet" media="screen and (min-width:300px) and (max-width:999px)" href="style300.css" />
<link rel="stylesheet" media="screen and (min-width:1000px) and (max-width:1499px)" href="style1000.css" />
<link rel="stylesheet" media="screen and (min-width:1500px)" href="style1500.css" />
<link rel="stylesheet" media="screen" href="home.css" />
</head>
<body onresize="structureElements()">
<div id="header">
<!-- Place Header Data -->
</div>
<div id="content">
    <div class='item'>
    	<img class='img' width='480' height="360" src="../Lab2/obama.jpg"/>
        <div class='star'></div>
    </div>
</div>
<div id="footerT">
<!-- Place footer Data -->
</div>
</body>
</html>
<script>
	
	function structureElements(){
		totalWidth = $(window).width();
		noOfitems = (totalWidth*0.8)/(226*0.8)
		//width = (totalWidth*0.8)/3;
		width = 226*0.8;
		width -= 10;
		delete itemPos;
		delete row;
		delete col;
		row = 0;
		col = 0;
		itemPos = Array();
			currentLeft = 0;
			currentTop = 10
			//width = 500;
			tempItem = items[0].print(0);
			img = tempItem.find('img');
			currentWidth = width;
			img.width(width);
			
			tempItem.css({
			   left : currentLeft+'px',
			   top :  currentTop +'px',
			   width: currentWidth+'px'
			});
			$('#content').html(tempItem);
			itemPos.push(Array());
			itemPos[row][col++] = {left:currentLeft,width:currentWidth,height:tempItem.height(),top:currentTop};
			currentLeft += currentWidth+10;
			
			for(i = 1;i<items.length;i++){
				tempItem = items[i].print(i);
				img = tempItem.find('img');
				currentWidth = width;
				img.width(width);
				
				if( (currentLeft + currentWidth) > (totalWidth * 0.8) ){
					row++;
					itemPos.push(Array());
					col = 0;
					currentLeft = 0;
				}else{
					if(itemPos[row].length >= noOfitems){
						row++;
						itemPos.push(Array());
						col = 0;
						currentLeft = 0;
					}
				}
				
				if(row > 0 ){
					tempCol = col;
					check = true;
					while(check){
						currentItem = itemPos[row-1][tempCol];
						if(currentItem == null){
							tempCol--;
							continue;
						}
						upTop = currentItem.top;
						upHeight = currentItem.height;
						upLeft = currentItem.left;
						upWidth = currentItem.width;
						maxTop = upTop+upHeight+10;
						if(currentLeft >= upLeft){
							if((currentLeft+currentWidth) <= (upLeft + upWidth)){
								currentTop = upTop + upHeight + 10
								check = false;
								/* Lies within the item above it*/
							}else{
								console.log(tempCol+1 + 'RowMax '+ itemPos[row-1].length);
								tempCheck = true;
								for(j=tempCol+1;j<itemPos[row-1].length;j++){
									currentItem = itemPos[row-1][j];
									if(currentItem == null){
										console.log("115- " + i);
										currentTop = maxTop;
										check = false;
										break;
									}
									upTop = currentItem.top;
									upHeight = currentItem.height;
									upLeft = currentItem.left;
									upWidth = currentItem.width;
									tmpWidth = currentLeft + currentWidth;
									newWidth = upLeft + upWidth;
									console.log(tmpWidth + ' - ' + newWidth);
									if((currentLeft+currentWidth) <= (upLeft + upWidth)){

										currentTop = Math.max(maxTop,upTop + upHeight + 10);
										check = false;
										tempCheck = false;
										break;
										/* Lies within the item above it*/
									}
								}
								if(tempCheck){
									currentTop = maxTop;
									check = false;
								}
								
							}
						}else{
							tempCol--;
							/* Repeat with previous Col*/
						}
					}
					
				}
				tempItem.css({
				   left : currentLeft+'px',
				   top  : currentTop+'px',
				   width: currentWidth+'px'
				});	
				$('#content').append(tempItem);
				itemPos[row][col++] = {left:currentLeft,width:currentWidth,height:tempItem.height(),top:currentTop};
				currentLeft += currentWidth + 10;
				
			}
			
	}
	window.onload = function(){
			setTimeout(function (){
				structureElements()
			},50);
	};
</script>
<!-- Script loading -->
<script src="jquery.js"></script>
<script src="parser.js"></script>